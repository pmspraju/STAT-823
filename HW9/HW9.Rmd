---
title: "HW9 - Multiple Regression"
author: "Madhu Peduri"
date: "`r format(Sys.time(), '%B %e, %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document:
    citation_package: natbib
    fig_caption: yes
    highlight: tango
    number_sections: yes
subparagraph: yes
header-includes: \usepackage{hyperref} \usepackage{framed,xcolor} \definecolor{shadecolor}{rgb}{0.99,
  0.95, 0.9} \renewcommand\arraystretch{1.5} \usepackage[none]{hyphenat} \raggedright
  \usepackage{amsmath, amsthm, amssymb, bm}
---

  
```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
library(rmarkdown)
library(graphics)
library(ggplot2)
library(MASS)
library(Hmisc)
library(epiDisplay)
library(vcd)
library(mnormt)
library(MASS)
library(car)
library(ggpubr)
library(PairedData)
library(lmtest)
library(xtable)
options(digits = 3)
opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy=TRUE)
```

### Problem 1 

```{r}
# Read the data
senic <- read.delim("SENIC.txt", header=FALSE,sep = "")
names(senic) <- c('id','stay','age','inf_risk', 'cul_r','xray_r','beds','med','region','daily_avg','nurses','services')
head(senic)

# lm for infection risk
lm1 <- lm(stay ~ inf_risk, data=senic)
summary(lm1)

# lm for available facilities
lm2 <- lm(stay ~ services, data=senic)
summary(lm2)

#lm for xray ratio
lm3 <- lm(stay ~ xray_r, data=senic)
summary(lm3)

# lm plots
par(mfrow = c(1,3))
plot(senic$stay ~ senic$inf_risk, cex = 1.5, cex.lab = 1.5, las = 1, cex.main = 1.5, xlab='Infection risk', ylab='average length of stay')
abline(lm1, lwd = 2, col = "red")
plot(senic$stay ~ senic$services, cex = 1.5, cex.lab = 1.5, las = 1, cex.main = 1.5, xlab='Services', ylab='average length of stay')
abline(lm2, lwd = 2, col = "red")
plot(senic$stay ~ senic$xray_r, cex = 1.5, cex.lab = 1.5, las = 1, cex.main = 1.5, xlab='X ray ratio', ylab='average length of stay')
abline(lm3, lwd = 2, col = "red")
```

#### Observation
- If we observe the p-values, we have values < 0.05 for three predictors. This says that the null hypothesis of having coefficients = 0 is rejected and linear relation between predictor and response holds good. This suggest the linearity with confidence (1- pvalue)%. 
- Plots of regression functions also shows the linear relationship provide a good fit for all the three predictors.


### Problem 2

```{r}
#Mean squared error
mse1 <- mean(lm1$residuals^2)
mse2 <- mean(lm2$residuals^2)
mse3 <- mean(lm3$residuals^2)
mse <- c(mse1,mse2,mse3)
r2 <- c(summary(lm1)$r.squared, summary(lm2)$r.squared, summary(lm3)$r.squared)
df <- data.frame(MSE=mse,R2=r2)
row.names(df) <- c('Infection risk','Facilities and Services','Chest X-ray ratio')
df
```

#### Observation
- R-square values are under 0.3 for all the three predictors. This shows that less than 30% of variance in dependent variable is explained by these univariate models.
- For the 'Infection risk' predictor, we have less mean square value and hightest Rsquare, so we can say out of three predictors, 'Infection risk' has the largest reduction in variablity of the average length of stay.

### Problem 3

```{r}
# Residual plots
par(mfrow = c(1, 3))
plot(fitted(lm1), residuals(lm1))
abline(h = 0)
plot(fitted(lm2), abs(residuals(lm2)))
abline(h = 0)
plot(fitted(lm3), abs(residuals(lm3)))
abline(h = 0)

par(mfrow = c(1, 3))
plot(lm1,which=c(1))
plot(lm2,which=c(1))
plot(lm3,which=c(1))

# Linearity of residuals
par(mfrow = c(1, 3))
qqnorm(residuals(lm1), main = "QQ Plot-Infection risk")
qqline(residuals(lm1))
shapiro.test(residuals(lm1))

qqnorm(residuals(lm2), main = "QQ Plot-Services")
qqline(residuals(lm2))
shapiro.test(residuals(lm2))

qqnorm(residuals(lm3), main = "QQ Plot-Xray ratio")
qqline(residuals(lm3))
shapiro.test(residuals(lm3))

# Homoscedasticity 
ncvTest(lm1)
ncvTest(lm2)
ncvTest(lm3)

# Correlation
dwtest(lm1)
dwtest(lm2)
dwtest(lm3)
```

#### Observation
- If we see the residual plots, model with infection risk is better compared to other two. 
- Normality: The p-values of shapiro test are less than the significant value < 0.05. Low p-values reject the null hypothesis of normality and that suggests that residuals are not following normal distribution. However, if we see the Qplots, we can see the normality, but presence of outliers could be the reason behind the poor p-values.
- Homoscedasticity: ncvtest has null hypothesis of constant variance for residuals. We have p-values less than the significant value 0.05. This shows the variance is changing basing on the change in the fitted valus. 
- Correlation: Dwtest has the null hypothesis  that the residuals from a linear regression are uncorrelated. Our test has p-values higher than 0.05 suggesting the presence of correlation between dependent and independent variables. 

## Document Information.

All of the statistical analyses in this document will be performed using `r R.version.string`.  R packages used will be maintained using the [packrat](http://rstudio.github.io/packrat/) dependency management system.  

```{r session-info}
sessionInfo()
```
